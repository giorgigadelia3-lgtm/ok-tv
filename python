import os
import json
import gspread
from google.oauth2.service_account import Credentials

# -----------------------------
# âœ… Google Sheets áƒ“áƒáƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ”áƒ‘áƒ
# -----------------------------

try:
    # JSON credentials Render-áƒ–áƒ” áƒ¨áƒ”áƒœáƒáƒ®áƒ£áƒšáƒ˜ áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ Environment Variable-áƒ¨áƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒáƒ“ GOOGLE_APPLICATION_CREDENTIALS_JSON
    google_creds_json = os.getenv("GOOGLE_APPLICATION_CREDENTIALS_JSON")

    if not google_creds_json:
        raise Exception("âŒ GOOGLE_APPLICATION_CREDENTIALS_JSON áƒáƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ Render-áƒ–áƒ”.")

    creds_dict = json.loads(google_creds_json)

    # áƒ£áƒ¤áƒ áƒ áƒ¤áƒáƒ áƒ—áƒ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ— (Drive access + Spreadsheet access)
    scopes = [
        "https://www.googleapis.com/auth/spreadsheets",
        "https://www.googleapis.com/auth/drive"
    ]

    creds = Credentials.from_service_account_info(creds_dict, scopes=scopes)
    client = gspread.authorize(creds)

    # áƒ¨áƒ”áƒœáƒ˜ Sheet ID (áƒ›áƒ®áƒáƒšáƒáƒ“ áƒ¨áƒ£áƒ áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ áƒ‘áƒ›áƒ£áƒšáƒ˜áƒ“áƒáƒœ!)
    SPREADSHEET_ID = "1zKL6iFYEw6rUX89MtYUpE9OAUMxIHq3cOQmdL_y2H9E"

    # áƒ£áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ“áƒ”áƒ‘áƒ áƒáƒ˜áƒ áƒ•áƒ”áƒš worksheet-áƒ¡
    sheet = client.open_by_key(SPREADSHEET_ID).sheet1
    print("âœ… áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ“áƒáƒ£áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ“áƒ Google Sheets-áƒ¡")

except Exception as e:
    sheet = None
    print(f"âš ï¸ Sheets áƒ“áƒáƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: {e}")


# -----------------------------
# âœ… áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ˜áƒ¡ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ
# -----------------------------
def save_to_sheet(hotel_name, address, comment, agent_name):
    if not sheet:
        print("âš ï¸ Sheets áƒ›áƒ˜áƒ£áƒ¬áƒ•áƒ“áƒáƒ›áƒ”áƒšáƒ˜áƒ â€” áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜ áƒ•áƒ”áƒ  áƒ©áƒáƒ˜áƒ¬áƒ”áƒ áƒ”áƒ‘áƒ.")
        return

    try:
        sheet.append_row([hotel_name, address, comment, agent_name])
        print("âœ… áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ˜ áƒ“áƒáƒ”áƒ›áƒáƒ¢áƒ Google Sheets-áƒ¨áƒ˜")
    except Exception as e:
        print(f"âŒ Sheets Error: {e}")


# -----------------------------
# ğŸ’¡ áƒ¢áƒ”áƒ¡áƒ¢áƒáƒ“ áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒ áƒ”áƒ¡ áƒ’áƒáƒáƒ¨áƒ•áƒ”áƒ‘ áƒáƒ“áƒ’áƒ˜áƒšáƒáƒ‘áƒ áƒ˜áƒ•áƒáƒ“:
# -----------------------------
if __name__ == "__main__":
    # áƒ¢áƒ”áƒ¡áƒ¢ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ˜
    test_hotel = "Green Hotel"
    test_address = "áƒ–áƒ£áƒ áƒáƒ‘ áƒáƒ’áƒšáƒáƒ«áƒ˜áƒ¡ 5"
    test_comment = "áƒ›áƒ˜áƒ•áƒ§áƒ˜áƒ“áƒ” áƒ¡áƒ áƒ£áƒšáƒ˜ áƒáƒáƒ™áƒ”áƒ¢áƒ˜"
    test_agent = "áƒ›áƒáƒ áƒ˜áƒáƒ› áƒ¯áƒ£áƒ¦áƒ”áƒšáƒ˜"

    save_to_sheet(test_hotel, test_address, test_comment, test_agent)
